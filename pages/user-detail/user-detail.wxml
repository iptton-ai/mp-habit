<!--pages/user-detail/user-detail.wxml-->
<view class="page user-detail-page" style="background: {{currentTheme.background}}">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="card user-info-card">
    <view wx:if="{{mode === 'view'}}">
      <view class="user-header">
        <view class="user-avatar">{{user.avatar}}</view>
        <view class="user-basic">
          <view class="user-name">{{user.name}}</view>
          <view class="user-create-time">åˆ›å»ºæ—¶é—´ï¼š{{user.createTime}}</view>
          <view class="user-points" style="color: {{currentTheme.primary}}">
            ğŸ’° å½“å‰ç§¯åˆ†ï¼š{{userData.totalPoints}}
          </view>
        </view>
        <button class="edit-btn" style="background: {{currentTheme.primary}}" bindtap="switchToEdit">
          ç¼–è¾‘
        </button>
      </view>
    </view>
    
    <view wx:if="{{mode === 'edit'}}">
      <view class="edit-header">
        <text class="edit-title">ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯</text>
      </view>
      
      <view class="edit-form">
        <view class="form-item">
          <view class="form-label">ç”¨æˆ·å</view>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥ç”¨æˆ·å" 
            value="{{editName}}"
            bindinput="onNameInput"
            maxlength="10"
          />
        </view>
        
        <view class="form-item">
          <view class="form-label">é€‰æ‹©å¤´åƒ</view>
          <view class="avatar-grid">
            <view
              class="avatar-option {{editAvatar === item ? 'selected' : ''}}"
              wx:for="{{avatarOptions}}"
              wx:key="*this"
              bindtap="selectAvatar"
              data-avatar="{{item}}"
              style="border-color: {{currentTheme.primary}}"
            >
              {{item}}
            </view>
          </view>
        </view>

        <view class="form-item">
          <view class="form-label">é€‰æ‹©ä¸»é¢˜</view>
          <view class="theme-grid">
            <view
              class="theme-option {{editThemeKey === item.key ? 'selected' : ''}}"
              wx:for="{{themeOptions}}"
              wx:key="key"
              bindtap="selectTheme"
              data-theme-key="{{item.key}}"
              style="border-color: {{editThemeKey === item.key ? item.primary : '#ddd'}}"
            >
              <view class="theme-color" style="background: {{item.primary}}"></view>
              <view class="theme-name">{{item.name}}</view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="edit-actions">
        <button class="action-btn cancel-btn" bindtap="cancelEdit">å–æ¶ˆ</button>
        <button class="action-btn save-btn" style="background: {{currentTheme.primary}}" bindtap="saveUser">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡ -->
  <view class="card stats-card">
    <view class="section-title">ğŸ“Š æ•°æ®ç»Ÿè®¡</view>
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-icon">ğŸ“</view>
        <view class="stat-number">{{userData.habits.length}}</view>
        <view class="stat-label">ä¹ æƒ¯</view>
      </view>
      <view class="stat-item">
        <view class="stat-icon">ğŸ</view>
        <view class="stat-number">{{userData.rewards.length}}</view>
        <view class="stat-label">å¥–åŠ±</view>
      </view>
      <view class="stat-item">
        <view class="stat-icon">ğŸ“Š</view>
        <view class="stat-number">{{userData.records.length}}</view>
        <view class="stat-label">è®°å½•</view>
      </view>
      <view class="stat-item">
        <view class="stat-icon">ğŸ’°</view>
        <view class="stat-number">{{userData.totalPoints}}</view>
        <view class="stat-label">ç§¯åˆ†</view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘ä¹ æƒ¯ -->
  <view class="card" wx:if="{{userData.habits.length > 0}}">
    <view class="section-title">â­ æœ€è¿‘ä¹ æƒ¯</view>
    <view class="habits-preview">
      <view 
        class="habit-item" 
        wx:for="{{userData.habits}}" 
        wx:key="id" 
        wx:if="{{index < 3}}"
        style="border-color: {{currentTheme.cardBorder}}"
      >
        <view class="habit-name">{{item.name}}</view>
        <view class="habit-points" style="color: {{item.type === 'positive' ? '#28a745' : '#dc3545'}}">
          {{item.type === 'positive' ? '+' : ''}}{{item.points}}åˆ†
        </view>
      </view>
      <view class="more-hint" wx:if="{{userData.habits.length > 3}}">
        è¿˜æœ‰ {{userData.habits.length - 3}} ä¸ªä¹ æƒ¯...
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘å¥–åŠ± -->
  <view class="card" wx:if="{{userData.rewards.length > 0}}">
    <view class="section-title">ğŸ æœ€è¿‘å¥–åŠ±</view>
    <view class="rewards-preview">
      <view 
        class="reward-item" 
        wx:for="{{userData.rewards}}" 
        wx:key="id" 
        wx:if="{{index < 3}}"
        style="border-color: {{currentTheme.cardBorder}}"
      >
        <view class="reward-name">{{item.name}}</view>
        <view class="reward-points" style="color: {{currentTheme.primary}}">{{item.points}}åˆ†</view>
      </view>
      <view class="more-hint" wx:if="{{userData.rewards.length > 3}}">
        è¿˜æœ‰ {{userData.rewards.length - 3}} ä¸ªå¥–åŠ±...
      </view>
    </view>
  </view>

  <!-- å±é™©æ“ä½œ -->
  <view class="card danger-card">
    <view class="section-title">âš ï¸ å±é™©æ“ä½œ</view>
    <view class="danger-actions">
      <button class="danger-btn reset-btn" bindtap="resetPoints">
        é‡ç½®ç§¯åˆ†
      </button>
      <button class="danger-btn clear-btn" bindtap="clearUserData">
        æ¸…ç©ºæ‰€æœ‰æ•°æ®
      </button>
    </view>
    <view class="danger-warning">
      âš ï¸ ä»¥ä¸Šæ“ä½œä¸å¯æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œ
    </view>
  </view>
</view>
