<!--pages/users/users.wxml-->
<view class="page users-page" style="background: {{currentTheme.background}}">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="card">
    <view class="page-title">
      <text class="title-icon">ğŸ‘¥</text>
      <text class="title-text">ç”¨æˆ·ç®¡ç†</text>
    </view>
    <view class="page-subtitle">ç®¡ç†æ‰€æœ‰ç”¨æˆ·ï¼Œåˆ‡æ¢å½“å‰ç”¨æˆ·</view>
  </view>

  <!-- å½“å‰ç”¨æˆ·ä¿¡æ¯ -->
  <view class="card current-user-card">
    <view class="section-title">ğŸŒŸ å½“å‰ç”¨æˆ·</view>
    <view class="current-user" wx:for="{{users}}" wx:key="id" wx:if="{{item.id === currentUserId}}">
      <view class="user-avatar">{{item.avatar}}</view>
      <view class="user-info">
        <view class="user-name">{{item.name}}</view>
        <view class="user-points">ç§¯åˆ†ï¼š{{item.totalPoints}}</view>
        <view class="user-stats">
          ä¹ æƒ¯ï¼š{{item.habitsCount}} | å¥–åŠ±ï¼š{{item.rewardsCount}} | è®°å½•ï¼š{{item.recordsCount}}
        </view>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <view class="card">
    <view class="section-header">
      <view class="section-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ æ‰€æœ‰ç”¨æˆ·</view>
      <button class="add-btn" style="background: {{currentTheme.primary}}" bindtap="showAddUser">
        â• æ·»åŠ ç”¨æˆ·
      </button>
    </view>
    
    <view class="users-list">
      <view 
        class="user-item {{item.id === currentUserId ? 'current' : ''}}" 
        wx:for="{{users}}" 
        wx:key="id"
        style="border-color: {{currentTheme.cardBorder}}"
      >
        <view class="user-main" bindtap="viewUserDetail" data-user-id="{{item.id}}">
          <view class="user-avatar">{{item.avatar}}</view>
          <view class="user-info">
            <view class="user-name">
              {{item.name}}
              <text class="current-badge" wx:if="{{item.id === currentUserId}}" style="background: {{currentTheme.primary}}">å½“å‰</text>
            </view>
            <view class="user-points" style="color: {{currentTheme.primary}}">ğŸ’° {{item.totalPoints}} ç§¯åˆ†</view>
            <view class="user-stats">
              ğŸ“ {{item.habitsCount}}ä¹ æƒ¯ | ğŸ {{item.rewardsCount}}å¥–åŠ± | ğŸ“Š {{item.recordsCount}}è®°å½•
            </view>
          </view>
        </view>
        
        <view class="user-actions">
          <button 
            class="action-btn switch-btn" 
            wx:if="{{item.id !== currentUserId}}"
            style="background: {{currentTheme.primaryLight}}; color: {{currentTheme.primary}}"
            bindtap="switchUser" 
            data-user-id="{{item.id}}"
          >
            åˆ‡æ¢
          </button>
          <button 
            class="action-btn edit-btn" 
            style="background: {{currentTheme.secondary}}; color: {{currentTheme.primary}}"
            bindtap="editUser" 
            data-user-id="{{item.id}}"
          >
            ç¼–è¾‘
          </button>
          <button 
            class="action-btn delete-btn" 
            wx:if="{{users.length > 1}}"
            bindtap="deleteUser" 
            data-user-id="{{item.id}}"
            data-user-name="{{item.name}}"
          >
            åˆ é™¤
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ•°æ®åŒæ­¥ -->
  <view class="card">
    <view class="section-title">ğŸ”„ æ•°æ®åŒæ­¥</view>
    <view class="sync-description">ä»å…¶ä»–ç”¨æˆ·å¤åˆ¶ä¹ æƒ¯æˆ–å¥–åŠ±åˆ°å½“å‰ç”¨æˆ·</view>
    <button class="sync-btn" style="background: {{currentTheme.primary}}" bindtap="goToDataSync">
      å¼€å§‹åŒæ­¥æ•°æ®
    </button>
  </view>

  <!-- æ·»åŠ ç”¨æˆ·å¯¹è¯æ¡† -->
  <view class="modal" wx:if="{{showAddDialog}}">
    <view class="modal-mask" bindtap="hideAddUser"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ æ–°ç”¨æˆ·</text>
        <text class="modal-close" bindtap="hideAddUser">âœ•</text>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <view class="form-label">ç”¨æˆ·å</view>
          <input 
            class="form-input" 
            placeholder="è¯·è¾“å…¥ç”¨æˆ·å" 
            value="{{newUserName}}"
            bindinput="onNameInput"
            maxlength="10"
          />
        </view>
        
        <view class="form-item">
          <view class="form-label">é€‰æ‹©å¤´åƒ</view>
          <view class="avatar-grid">
            <view 
              class="avatar-option {{newUserAvatar === item ? 'selected' : ''}}" 
              wx:for="{{avatarOptions}}" 
              wx:key="*this"
              bindtap="selectAvatar"
              data-avatar="{{item}}"
              style="border-color: {{currentTheme.primary}}"
            >
              {{item}}
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="modal-btn cancel-btn" bindtap="hideAddUser">å–æ¶ˆ</button>
        <button class="modal-btn confirm-btn" style="background: {{currentTheme.primary}}" bindtap="confirmAddUser">ç¡®è®¤</button>
      </view>
    </view>
  </view>
</view>
