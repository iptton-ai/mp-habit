<!--pages/records/records.wxml-->
<view class="page" style="background: {{currentTheme.background || 'linear-gradient(135deg, #FFE4E6 0%, #FFF0F5 50%, #E8F5E8 100%)'}}">
  <!-- ç§¯åˆ†æ˜¾ç¤º -->
  <view class="points-display" style="background: linear-gradient(135deg, {{currentTheme.primary || '#FF69B4'}} 0%, {{currentTheme.primaryDark || '#FF1493'}} 50%, {{currentTheme.primaryLight || '#FFB6C1'}} 100%)">
    <view class="points-icon">{{currentTheme.emoji || 'ğŸŒŸ'}}</view>
    <view class="points-number">{{totalPoints}}</view>
    <view class="points-label">âœ¨ æˆ‘çš„å°æ˜Ÿæ˜Ÿ âœ¨</view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="card">
    <view class="section-title mb-20">ç»Ÿè®¡ä¿¡æ¯</view>
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-number text-primary">{{stats.totalHabits}}</view>
        <view class="stat-label">å®Œæˆä¹ æƒ¯</view>
      </view>
      <view class="stat-item">
        <view class="stat-number text-warning">{{stats.totalRewards}}</view>
        <view class="stat-label">å…‘æ¢å¥–åŠ±</view>
      </view>
      <view class="stat-item">
        <view class="stat-number text-primary">{{stats.totalPointsEarned}}</view>
        <view class="stat-label">è·å¾—ç§¯åˆ†</view>
      </view>
      <view class="stat-item">
        <view class="stat-number text-danger">{{stats.totalPointsSpent}}</view>
        <view class="stat-label">æ¶ˆè€—ç§¯åˆ†</view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ“ä½œ -->
  <view class="card">
    <view class="filter-section">
      <view class="filter-label">ç­›é€‰è®°å½•ï¼š</view>
      <picker
        mode="selector"
        range="{{filterOptions}}"
        range-key="label"
        value="{{currentFilterIndex}}"
        bindchange="onFilterChange"
      >
        <view class="filter-picker">
          {{currentFilterLabel}}
          <text class="picker-arrow">></text>
        </view>
      </picker>
    </view>
    
    <view class="action-section">
      <button class="btn-danger btn-small" bindtap="clearAllRecords">æ¸…ç©ºè®°å½•</button>
    </view>
  </view>

  <!-- è®°å½•åˆ—è¡¨ -->
  <view class="card">
    <view class="section-title mb-20">
      è®°å½•åˆ—è¡¨ ({{filteredRecords.length}})
    </view>
    
    <view wx:if="{{filteredRecords.length > 0}}">
      <view class="record-item" wx:for="{{filteredRecords}}" wx:key="id">
        <view class="record-main">
          <view class="record-header">
            <view class="record-name">{{item.itemName}}</view>
            <view class="record-points {{item.type === 'habit' ? (item.points > 0 ? 'text-primary' : 'text-danger') : 'text-warning'}}">
              {{item.type === 'habit' ? (item.points > 0 ? '+' : '') : '-'}}{{Math.abs(item.points)}}ç§¯åˆ†
            </view>
          </view>
          
          <view class="record-info">
            <view class="record-type">
              {{item.type === 'habit' ? 'ä¹ æƒ¯è®°å½•' : 'å¥–åŠ±å…‘æ¢'}}
            </view>
            <view class="record-time">
              {{utils.formatTime(item.createTime)}}
            </view>
          </view>
        </view>
        
        <view class="record-action">
          <button class="btn-cancel-small" style="background: {{currentTheme.secondary || '#FFF0F5'}}; color: {{currentTheme.primary || '#FF69B4'}}; border-color: {{currentTheme.primaryLight || '#FFB6C1'}}" bindtap="cancelRecord" data-record="{{item}}">
            å–æ¶ˆ
          </button>
        </view>
      </view>
    </view>
    
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“‹</view>
      <view class="empty-text">
        {{filterType === 'all' ? 'è¿˜æ²¡æœ‰ä»»ä½•è®°å½•' : 
          filterType === 'habit' ? 'è¿˜æ²¡æœ‰ä¹ æƒ¯è®°å½•' : 'è¿˜æ²¡æœ‰å¥–åŠ±è®°å½•'}}
      </view>
    </view>
  </view>
</view>

<wxs module="utils">
  var formatTime = function(timestamp) {
    var date = getDate(timestamp)
    var year = date.getFullYear()
    var month = date.getMonth() + 1
    var day = date.getDate()
    var hour = date.getHours()
    var minute = date.getMinutes()
    
    var formatNumber = function(n) {
      return n < 10 ? '0' + n : n.toString()
    }
    
    return year + '/' + formatNumber(month) + '/' + formatNumber(day) + ' ' + 
           formatNumber(hour) + ':' + formatNumber(minute)
  }
  
  module.exports = {
    formatTime: formatTime
  }
</wxs>
